<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>C++ Graph Plotter</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <div class="app">
        <header>
            <h1>Server-Side Graph Plotter</h1>
            <p>Enter comma-separated values and choose a plot style.</p>
        </header>
        <section class="panel">
            <form id="plot-form">
                <label>
                    X Values
                    <input type="text" name="xValues" placeholder="e.g. 0, 1, 2, 3, 4" required>
                </label>
                <label>
                    Y Values
                    <input type="text" name="yValues" placeholder="e.g. 0, 1.3, 2.5, 1.2, 0.5" required>
                </label>
                <label>
                    Plot Type
                    <select name="plot">
                        <option value="line">Line</option>
                        <option value="scatter">Scatter</option>
                        <option value="bar">Bar</option>
                    </select>
                </label>
                <button type="submit">Generate Plot</button>
            </form>
            <div id="status"></div>
        </section>
        <section class="panel image-panel">
            <div class="image-frame">
                <img id="plot-image" alt="Generated plot will appear here" />
            </div>
        </section>
    </div>

    <script>
        const form = document.getElementById('plot-form');
        const status = document.getElementById('status');
        const img = document.getElementById('plot-image');

        form.addEventListener('submit', async (event) => {
            event.preventDefault();
            status.textContent = 'Rendering...';
            const formData = new FormData(form);
            const body = new URLSearchParams();
            for (const [key, value] of formData.entries()) {
                body.append(key, value);
            }
            try {
                const response = await fetch('/plot', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: body.toString()
                });
                if (!response.ok) {
                    status.textContent = 'Error: ' + await response.text();
                    return;
                }
                const blob = await response.blob();
                img.src = URL.createObjectURL(blob);
                status.textContent = 'Done.';
            } catch (err) {
                status.textContent = 'Request failed: ' + err.message;
            }
        });
    </script>
</body>
</html>
